<!doctype html><html lang=zh dir=ltr class=dark><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>隨筆．關於類別 | Nyanyannya</title><meta name=generator content="Hugo Eureka 0.9.3"><link rel=stylesheet href=https://pixelcat31415.github.io/blog/css/eureka.min.20bf94c567492e2ea21b897b2a393ba2983300cfd37b3b5230fda8031e17e158c857d7836412680573ad3fb8bf13c24c.css><link rel=stylesheet href=https://pixelcat31415.github.io/blog/css/custom.min.c2e31c90f8a39864d5629307aade5b55274d6136c9ccfadcc74e713cc3974070.css><script defer src=https://pixelcat31415.github.io/blog/js/custom.min.875ea4498b8d9bd2a60fb29a1001fd9ad6e1b57892b66ef7cabd1dddf63f0ed9445c8abe0299bed48a8d26c53b664121.js></script>
<script defer src=https://pixelcat31415.github.io/blog/js/eureka.min.fa9a6bf6d7a50bb635b4cca7d2ba5cf3dfb095ae3798773f1328f7950028b48c17d06276594e1b5f244a25a6c969a705.js></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Noto+Serif+SC:wght@400;600;700&display=swap" as=style onload='this.onload=null,this.rel="stylesheet"'><script defer type=text/javascript src=https://pixelcat31415.github.io/blog/js/fontawesome.min.d7a06596d5235d9f1b5059e0ae8884040d48f9219364c0e1651316fe993117293d949acaa248654110fb3ba464959bed.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><link rel=icon type=image/png sizes=32x32 href=https://pixelcat31415.github.io/blog/images/icon_hu4ecd239f579111d388d3334bfa697660_2793_32x32_fill_box_center_3.png><link rel=apple-touch-icon sizes=180x180 href=https://pixelcat31415.github.io/blog/images/icon_hu4ecd239f579111d388d3334bfa697660_2793_180x180_fill_box_center_3.png><meta name=description content="OOP 已經不是什麼新概念了。我會的程式語言算一算可能有 C、C++、Python，勉強一點算上 Typescript，其中除了純 C 以外都有 class 這個關鍵字可以實做"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://pixelcat31415.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"隨筆．關於類別","item":"https://pixelcat31415.github.io/blog/2024/08/thoughts-typescript-classes/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://pixelcat31415.github.io/blog/2024/08/thoughts-typescript-classes/"},"headline":"隨筆．關於類別 | Nyanyannya","datePublished":"2024-08-01T22:34:30+08:00","dateModified":"2024-08-01T22:34:30+08:00","wordCount":1755,"publisher":{"@type":"Person","name":"PixelCat","logo":{"@type":"ImageObject","url":"https://pixelcat31415.github.io/blog/images/icon.png"}},"description":"OOP 已經不是什麼新概念了。我會的程式語言算一算可能有 C、C\u002b\u002b、Python，勉強一點算上 Typescript，其中除了純 C 以外都有 class 這個關鍵字可以實做"}</script><meta property="og:title" content="隨筆．關於類別 | Nyanyannya"><meta property="og:type" content="article"><meta property="og:image" content="https://pixelcat31415.github.io/blog/images/icon.png"><meta property="og:url" content="https://pixelcat31415.github.io/blog/2024/08/thoughts-typescript-classes/"><meta property="og:description" content="OOP 已經不是什麼新概念了。我會的程式語言算一算可能有 C、C++、Python，勉強一點算上 Typescript，其中除了純 C 以外都有 class 這個關鍵字可以實做"><meta property="og:locale" content="zh"><meta property="og:site_name" content="Nyanyannya"><meta property="article:published_time" content="2024-08-01T22:34:30+08:00"><meta property="article:modified_time" content="2024-08-01T22:34:30+08:00"><meta property="article:section" content="posts"><meta property="article:tag" content="隨筆"><meta property="og:see_also" content="https://pixelcat31415.github.io/blog/2024/01/thoughts-sweeping-lines/"><body class="flex min-h-screen flex-col"><header class="min-h-16 pl-scrollbar bg-secondary-bg fixed z-50 flex w-full items-center shadow-sm"><div class="mx-auto w-full max-w-screen-xl"><script>let storageColorScheme=localStorage.getItem("lightDarkMode");(storageColorScheme=="Auto"&&window.matchMedia("(prefers-color-scheme: light)").matches||storageColorScheme=="Light")&&document.getElementsByTagName("html")[0].classList.remove("dark")</script><nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0"><a href=/blog class="me-6 text-primary-text text-xl font-bold">Nyanyannya</a>
<button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
<i class="fas fa-bars"></i></button><div id=target class="hidden block md:flex md:grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20"><div class="md:flex md:h-16 text-sm md:grow pb-4 md:pb-0 border-b md:border-b-0"><a href=/blog/about class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">About</a>
<a href=/blog/posts/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Posts</a></div><div class=flex><div class="relative pt-4 md:pt-0" hidden><div class="cursor-pointer hover:text-eureka" id=lightDarkMode><i class="fas fa-moon"></i></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id=is-open></div><div class="absolute flex flex-col start-0 md:start-auto end-auto md:end-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40" id=lightDarkOptions><span class="px-4 py-1 hover:text-eureka" name=Light>Light</span>
<span class="px-4 py-1 hover:text-eureka" name=Dark>Dark</span>
<span class="px-4 py-1 hover:text-eureka" name=Auto>Auto</span></div></div></div></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id=is-open-mobile></div></nav><script>let element=document.getElementById("lightDarkMode");storageColorScheme=="Auto"?(element.firstElementChild.classList.remove("fa-moon"),element.firstElementChild.setAttribute("data-icon","adjust"),element.firstElementChild.classList.add("fa-adjust"),document.addEventListener("DOMContentLoaded",()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",switchDarkMode)})):storageColorScheme=="Light"&&(element.firstElementChild.classList.remove("fa-moon"),element.firstElementChild.setAttribute("data-icon","sun"),element.firstElementChild.classList.add("fa-sun")),document.addEventListener("DOMContentLoaded",()=>{getcolorscheme(),switchBurger()})</script></div></header><main class="grow pt-16"><div class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl lg:px-4 xl:px-8"><div class="grid grid-cols-2 gap-4 lg:grid-cols-8 lg:pt-12"><div class="lg:col-start-2 bg-secondary-bg col-span-2 rounded px-6 py-8 lg:col-span-6"><article class="prose post-article"><div class="text-tertiary-text not-prose mt-2 flex flex-row flex-wrap items-center post-metadata"><div class="me-6 my-2"><i class="fas fa-calendar me-1"></i>
<span>2024-08-01</span></div><div class="me-6 my-2"><i class="fas fa-edit me-1"></i>
<span>2024-08-01</span></div><div class="me-6 my-2"><i class="fas fa-tags me-1"></i>
<a href=https://pixelcat31415.github.io/blog/tags/%E9%9A%A8%E7%AD%86/ class=hover:text-eureka>隨筆</a></div></div><h1 class=mb-4>隨筆．關於類別</h1><p class=post-article-description></p><hr><div class=post-article-content><p>OOP 已經不是什麼新概念了。我會的程式語言算一算可能有 C、C++、Python，勉強一點算上 Typescript，其中除了純 C 以外都有 class 這個關鍵字可以實做類別。我也曾經覺得我會用 class，至少用這些語言在語法層面上要實做一個最簡單的類別都不難。</p><p>某天我拿 Typescript 搞事情，發現我沒辦法回答一個好像很簡單的問題：類別是什麼？</p><hr><p>我對類別的認識絕對是從 C++ 出發的，準確的說是從 C++ 的 struct 出發的。打競賽程式不時需要用到什麼資料結構像是線段樹或 BIT，我都喜歡用 struct 包起來，一方面保護命名空間，一方面喜歡把資料結構當成是一個黑盒子物件來用。C++ 的 struct 可以裝成員變數、方法，還可以繼承，跟 class 的界線淡到難以察覺<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>。</p><p>而 struct 又是什麼？大一下修 DSA 寫純 C 有更深的體會：純 C 的 struct 沒有方法沒有任何物件要素，就只是把一些資料綁一起讓你一整捆帶著走。對 C 來說，struct 就只是一塊稍微大塊一點的記憶體，而你賦予這塊記憶體裡面每一個部份不同的意義。每一個變數都只是一塊記憶體，是變數的型別讓編譯器知道該如何對待這塊記憶體，讓每個位元組合出有價值的資料而不再只是一串 01 數字</p><p>這種想法也可以放在指標上。指標本質上就是一個數字，代表記憶體裡的一個位置，但沒辦法表達那個位置的資料究竟表示什麼。你可以用兩個數字精確標上地球上任意一個點的經緯度，卻沒辦法用兩個數字就展現那個位置的地貌和生態系。讓數字升級成資料的方法只能使用型別，讓編譯器和我（碼農）了解，這邊的 24 個 byte 是六個整數，那邊的 24 個 byte 卻代表一個裝著十萬個整數的 vector。也因此你當然可以隨便 cast 指標的型別，只是對錯的資料做同樣的事情，就像把一頭獅子當貓咪來擼，就不保證不會出事了。</p><p>所以我心目中的類別是一種型別—如果有一塊記憶體是這種型別，那我知道裡面的每一個部份代表什麼、還可以對這塊記憶體做一些特別的事情。</p><hr><p>Python 呢？</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>C</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#f92672>...</span>   <span style=color:#66d9ef>def</span> __init__(self):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#f92672>...</span>     self<span style=color:#f92672>.</span>owo <span style=color:#f92672>=</span> <span style=color:#ae81ff>48763</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#f92672>...</span> 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#f92672>&gt;&gt;&gt;</span> type(C)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>class</span> <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#a6e22e>type</span><span style=color:#e6db74>&#39;&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#f92672>&gt;&gt;&gt;</span> C <span style=color:#f92672>=</span> <span style=color:#66d9ef>lambda</span> x: x <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#f92672>&gt;&gt;&gt;</span> type(C)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>class</span> <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#a6e22e>function</span><span style=color:#e6db74>&#39;&gt;</span>
</span></span></code></pre></div><p>類別確實是一種「型別」，但是應該說他是一個變數，這個變數的型別是「型別 <code>&lt;class 'type'></code>」。好的可以理解，因為在 python 裡面連函數、類別都裝在變數裡面，這些變數一樣可以被重新裝進任意型別的資料，做類別或函數宣告跟造一個類別或函數存進這個變數是一樣意思。</p><p>C/C++ 裡面函數雖然也是一塊記憶體（裝著一段機器碼的記憶體），也可以用指標找到，但是他們跟一般變數有地位上的區隔。.text 區段在你編譯下去的那個瞬間就不能改了（通常情況下），那是編譯器的地盤。</p><p>無妨，我依然更加確信類別是一種型別。</p><hr><p>直到我遇見 Typescript。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>C</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>public</span> <span style=color:#a6e22e>owo</span>: <span style=color:#66d9ef>number</span>) {}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>C</span>, <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>C</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>f</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> { <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>48763</span>; };
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>f</span>, <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>f</span>);
</span></span></code></pre></div><p>雖然 Typescript 的類別和函數也是裝在變數裡面，不過這次不能把別的東西裝進類別 C 了，因為 Typescript 不喜歡，很好我太喜歡這個設計了，比隔壁 python 合理多了。但是看看這個輸出。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>$ npx ts-node main.ts
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>[class C] function
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>[Function: f] function
</span></span></code></pre></div><p>class 是 function！</p><p>我要用更大的版面來表達我的震驚與頓悟、瞠目結舌與不可思議、信念的崩塌與對自我的質疑，以及我寫下這整篇感言的唯一契機。</p><blockquote><p>Typescript 覺得，類別是函數！</p></blockquote><p>Typescript 覺得，或者說 Javascript 覺得，類別就是一個函數，這個函數會吐一個物件回來給你。其實沒什麼好震驚的，每個 Javascript 新手教程一定會有幾篇跟你解釋工廠模式和原形鍊，說 new 實際上只是幫你呼叫這個函數造一個物件還你；class 語法也只是語法糖，沒有類別這件事，原形和工廠才是 Javascript 所有物件的基礎。</p><p>但這讓型別和變數的分野一時變得有點模糊。寫這個類別的名字，到底是指一個型別，還是一個函數？</p><p>一開始寫 Typescript 用 class 覺得特別親切，跟寫別的語言沒什麼區別，無縫接軌；仔細一讀才發現哪裡是無縫接軌，根本就是曲折坎坷。可能學什麼都像這樣吧，一開始不會，後來覺得會了，然後又發現其實不會，在會和不會之間來回折返踉蹌往前走。</p><p>工廠和原形展現一種不同的哲學，甚至不存在其他語言裡類別的概念。說到底 Javascript 所有物件的型別都是 Object，跟其他語言不同，甚至 Python 的物件至少都有各自的型別，或許這也是為什麼在其他語言中見不到 Object.defineProperty() 這麼特別的語法的原因。</p><hr><p>為什麼同樣的 class 這個字在不同語言要有不同的意義？也許原本 Javascript 設計的時候根本沒有 class 的概念，只是其他語言都有，所以把 Javascript 裡面類似的概念包裝成 class。就像在歐洲吃一桌台灣菜，很好吃，很有台灣味，但你還是嚐出了異鄉的味道。</p><p>想到這裡我只覺得設計每一種程式語言的人都是天才。</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>每次我想到 struct 和 class 都會回來複習 <a href=https://stackoverflow.com/questions/54585/when-should-you-use-a-class-vs-a-struct-in-c>這篇 stackoverflow</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article><div class=post-tags><div class=mt-4><span><i class="fas fa-tags me-1" style=width:20px></i>
標籤：</span>
<a href=https://pixelcat31415.github.io/blog/tags/%E9%9A%A8%E7%AD%86/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#隨筆</a></div><div class=mb-4></div></div><div class="-mx-2 mt-4 flex flex-col border-t px-2 pt-4 md:flex-row md:justify-between"><div><span class="text-primary-text block font-bold">prev</span>
<a href=https://pixelcat31415.github.io/blog/2024/06/courses-review-2024spring/ class=block>大一下修課心得（2024 Spring）</a></div><div class="mt-4 md:mt-0 md:text-right"></div></div></div></div></div></div></main><footer class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl"><div class="text-center p-6 pin-b"><p class="text-sm text-tertiary-text"></p></div></div></footer></body></html>